apiVersion: agones.dev/v1
kind: GameServer
metadata:
  name: ats
spec:
  eviction:
    safe: OnUpgrade
  ports:
  - name: game
    portPolicy: Passthrough
    container: ats
    containerPort: 27015
    hostPort: 27015
    protocol: TCPUDP
  - name: query
    portPolicy: Passthrough
    container: ats
    containerPort: 27016
    hostPort: 27016
    protocol: TCPUDP
  health:
    disabled: true
  template:
    metadata:
      labels:
        game: ats
    spec:
      containers:
      - name: ats
        image: lshallo/ats-convoy-server:latest
        imagePullPolicy: Always
        resources:
          requests:
            cpu: 2500m # 2.5 cpu cores
            memory: 4Gi
          limits:
            cpu: 2500m # 2.5 cpu cores
            memory: 4Gi
        env:
        - name: ETS_SERVER_SHOW_SERVER
          value: 'true'
        - name: ETS_SERVER_UPDATE_ON_START
          value: 'true'
        - name: ETS_SERVER_NAME
          value: '1tr-wtf'
        - name: ETS_SERVER_DESCRIPTION
          value: "1tr"
        - name: ETS_SERVER_WELCOME_MESSAGE
          value: "1tr"
        - name: ETS_SERVER_MAX_PLAYERS
          value: '8'
        - name: ETS_SERVER_PASSWORD
          valueFrom:
            secretKeyRef:
              name: ats
              key: server-password
        - name: ETS_SERVER_LOGON_TOKEN
          valueFrom:
            secretKeyRef:
              name: ats
              key: steam-login-token
